# SPDX-FileCopyrightText: 2022 Wilfred Nicoll <xyzroller@rollyourown.xyz>
# SPDX-License-Identifier: GPL-3.0-or-later

## Listening Address Settings
{% if host_public_ipv6 == true %}http_address = "[::]:4180"
{% else %}http_address = "0.0.0.0:4180"
{% endif %}


## Reverse Proxy Settings
reverse_proxy = true
real_client_ip_header = "X-Forwarded-For"

## OIDC Provider Settings for Gitea as IdP
provider = "oidc"
provider_display_name = "{{ project_idp_gitea_domain_name }}"
redirect_url = "https://{{ project_domain_name }}/oauth2/callback"
oidc_issuer_url = "https://{{ project_idp_gitea_domain_name }}/"
skip_oidc_discovery = false
scope = ""
client_id = "{{ project_idp_gitea_client_id }}"
client_secret = "{{ project_idp_gitea_client_secret }}"

# Upstream Settings
upstreams = [
    "http://[::1]:80/"
]

pass_access_token = false
pass_authorization_header = false
pass_basic_auth = false
pass_host_header = true
pass_user_headers = false

## Session storage
session_store_type = "cookie"

## Cookie Session Storage Settings
cookie_name = "_oauth2_proxy"
cookie_secret = "{{ oauth2_proxy_cookie_secret }}"
cookie_samesite = "lax"
cookie_secure = true
cookie_httponly = true
cookie_domains = ""
cookie_expire = "24h"
cookie_refresh = "1h"

## DEBUG Logging
#show_debug_on_error = true
#request_logging = true
#auth_logging = true
#standard_logging = true
#logging_filename = "/tmp/oa2p.log"

## TEST Bypass authentication for everything
#skip_auth_routes = [
#  "^/"
#]
